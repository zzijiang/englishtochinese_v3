<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Challenge</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Vocabulary Challenge</h1>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-bar"></div>
        </div>
        
        <script>
            // è·å–å½“å‰é¢˜å·å¹¶è®¡ç®—è¿›åº¦
            let questionNumber = {{ question_number }};
            let totalQuestions = 10;  // è®¾å®šæ€»é¢˜æ•°
            let progress = (questionNumber / totalQuestions) * 100;
        
            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById("progress-bar").style.width = progress + "%";
        </script>
        
        <h2>ç¬¬ {{ question_number }} é¢˜</h2>
        <p class="word">{{ question.english }}</p>

        <form id="quiz-form" action="{{ url_for('next_question') }}" method="post">
            <div class="options">
                {% for option in question.options %}
                    <button type="button" class="option-btn" onclick="submitAnswer(this)" data-answer="{{ option }}">
                        {{ option }}
                    </button>
                {% endfor %}
            </div>
            <p id="feedback" class="hidden"></p>  <!-- è¿™é‡Œç”¨äºæ˜¾ç¤ºæ­£ç¡®æˆ–é”™è¯¯åé¦ˆ -->
            <input type="hidden" name="answer" id="selected-answer">
        </form>
    </div>

    <script>
        function submitAnswer(button) {
            // è·å–ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆ
            let userAnswer = button.getAttribute("data-answer");
            document.getElementById("selected-answer").value = userAnswer;

            // è·å–æ­£ç¡®ç­”æ¡ˆï¼ˆä» Flask ä¼ é€’è¿‡æ¥ï¼‰
            let correctAnswer = "{{ question.correct_answer }}";
            
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            let buttons = document.querySelectorAll(".option-btn");
            buttons.forEach(btn => btn.disabled = true);

            // åé¦ˆæ–‡æœ¬
            let feedback = document.getElementById("feedback");

            // å¯èƒ½çš„åŠ¨æ€ Emoji
            let correctEmojis = ["ğŸ‰", "ğŸ¥³", "ğŸ‘", "ğŸ”¥", "ğŸš€", "ğŸ¯", "ğŸ˜ƒ"];
            let randomEmoji = correctEmojis[Math.floor(Math.random() * correctEmojis.length)];

            if (userAnswer === correctAnswer) {
                button.classList.add("correct");  // ç»¿è‰²é«˜äº®
                feedback.innerHTML = `âœ… æ­£ç¡®ï¼ <span class="correct-emoji">${randomEmoji}</span>`;
            } else {
                button.classList.add("wrong");  // çº¢è‰²é«˜äº®
                feedback.innerHTML = `âŒ é”™è¯¯ï¼<span class="black-text"> æ­£ç¡®ç­”æ¡ˆï¼š</span> <span class="green-text">${correctAnswer}</span>`;
            }

            // æ˜¾ç¤ºåé¦ˆä¿¡æ¯
            feedback.classList.remove("hidden");

            // 1.5 ç§’åè‡ªåŠ¨æäº¤è¡¨å•
            setTimeout(() => {
                document.getElementById("quiz-form").submit();
            }, 1500);
        }
    </script>
</body>
</html>
